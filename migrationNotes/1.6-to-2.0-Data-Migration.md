## Catalog Changes
# Products and Skus
The brunt of these changes are centered around the changes in how `Products` relate to `Sku`s (see [[Main Entities]] for how the relationships work now).  If you had a custom Product subclass, you would normally extend `ProductSkuImpl` since most framework users have the assumption that a Product itself can be sold.  Since this is the most common case, we have removed the `ProductSkuImpl` entity entirely, and pushed the one-to-one relationship from `Product` to `Sku` up to the `ProductImpl` entity, and moved fields that were in `ProductImpl` to`SkuImpl`.

As far as the database is concerned, if you already have a subclass of `ProductSkuImpl` (let's call it `MyCompanyProductImpl`) with its own table (let's call it MC_PRODUCT), you will probably have the following create syntax:

```sql
CREATE TABLE `MC_PRODUCT` (
  `MYCOMPANY_FIELD` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
  `PRODUCT_ID` bigint(20) NOT NULL,
  PRIMARY KEY (`PRODUCT_ID`),
  KEY `FK3CBEBADC689F939C` (`PRODUCT_ID`),
  CONSTRAINT `FK3CBEBADC689F939C` FOREIGN KEY (`PRODUCT_ID`) REFERENCES `BLC_PRODUCT_SKU` (`PRODUCT_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
```

Since `BLC_PRODUCT_SKU` no longer exists, this foreign key constraint should change to reference the root BLC_PRODUCT table.  This can be achieved by dropping and recreating the constraint to instead just reference the `BLC_PRODUCT` table:
```sql
ALTER TABLE `MC_PRODUCT` DROP FOREIGN KEY `FK3CBEBADC689F939C`;
ALTER TABLE `MC_PRODUCT` ADD CONSTRAINT `FK3CBEBADC689F939C` FOREIGN KEY (`PRODUCT_ID`) REFERENCES `BLC_PRODUCT` (`PRODUCT_ID`);
```

# Product Media
`Media` has also been changed to only be on a `Product`'s default `Sku` and the `BLC_PRODUCT_MEDIA_MAP table is no longer being used (and thus removed).  If you are currently using `ProductSkuImpl` (or a custom subclass of it) the migration for this involves a simple SQL query to move the media data onto the default `Sku`:
```sql
INSERT INTO BLC_SKU_MEDIA_MAP (SELECT PRODUCT_SKU.SKU_ID, MEDIA_ID, MAP_KEY FROM BLC_PRODUCT_MEDIA_MAP AS PRODUCT_MEDIA_MAP, BLC_PRODUCT_SKU AS PRODUCT_SKU WHERE PRODUCT_MEDIA_MAP.BLC_PRODUCT_PRODUCT_ID = PRODUCT_SKU.PRODUCT_ID);
```

## Raw Database Dumps
These dumps were generated by starting up applications with BLC 1.6.0 and 2.0.0 on MySQL 5.5.14 and are included here for further reference
*[[Raw 1.6 Dump|sql/broadleaf-1.6-raw.sql]]
*[[Raw 2.0 Dump|sql/broadleaf-2.0-raw.sql]]